<div class="mercado-container p-4">
  <!-- T칤tulo -->
  <div class="mb-4">
    <h2 class="text-white">Mercado Latinoamericano</h2>
    <p class="text-muted">Acciones de Colombia, Ecuador, Per칰 y Venezuela</p>
  </div>

  <!-- Spinner -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="text-white mt-3">Cargando datos del mercado colombiano...</p>
  </div>

  <!-- Error -->
  <div *ngIf="uiMessage && !loading" class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ uiMessage }}
  </div>

  <!-- Acciones Destacadas -->
  <div *ngIf="!loading && accionesDestacadas.length > 0" class="mb-5">
    <h4 class="text-white mb-3">
      <i class="bi bi-star-fill text-warning me-2"></i>
      Acciones Destacadas
    </h4>
    <div class="row">
      <div class="col-md-4 mb-4" *ngFor="let accion of accionesDestacadas">
        <div class="card h-100 shadow-sm text-white destacada-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <h5 class="card-title mb-1">{{ accion.simbolo }}</h5>
                <small class="text-muted">{{ accion.nombre }}</small>
              </div>
              <span class="badge bg-warning">Destacada</span>
            </div>

            <div class="precio-info mb-3">
              <h3 class="text-primary mb-1" *ngIf="tieneDatosPrecio(accion)">{{ formatearPrecio(accion) }}</h3>
              <h3 class="text-muted mb-1" *ngIf="!tieneDatosPrecio(accion)">N/A</h3>
              <small [ngClass]="getVariacionClass(getVariacionPorcentual(accion))">
                <i *ngIf="tieneDatosPrecio(accion)" [class]="getVariacionPorcentual(accion) >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                {{ formatearVariacionPorcentual(accion) }}
              </small>
            </div>

            <!-- Gr치fico de TradingView -->
            <div class="chart-container mb-3" *ngIf="deberaMostrarGrafico(accion.simbolo)">
              <iframe
                [src]="getChartUrl(accion.simbolo)"
                width="100%"
                height="200"
                frameborder="0"
                allowtransparency="true"
                scrolling="no"
                style="border: none;">
              </iframe>
            </div>

            <!-- Placeholder cuando el gr치fico no est치 disponible -->
            <div *ngIf="!deberaMostrarGrafico(accion.simbolo)" class="chart-placeholder mb-3">
              <i class="bi bi-graph-up-arrow text-primary" style="font-size: 3rem;"></i>
              <p class="text-muted mt-2 mb-0">{{ accion.nombre }}</p>
              <small class="text-muted">Gr치fico no disponible</small>
            </div>

            <div class="d-flex gap-2">
              <button class="btn btn-outline-info btn-sm flex-fill" (click)="abrirModalHistorialPrecios(accion.simbolo, accion.nombre)">
                <i class="bi bi-graph-up-arrow me-1"></i>Historial
              </button>
              <button class="btn btn-success btn-sm flex-fill" (click)="abrirModalCompra(accion.simbolo)">
                <i class="bi bi-cart-plus me-1"></i>Comprar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 游뻟릖 COLOMBIA -->
  <div *ngIf="!loading && accionesColombia.length > 0" class="mb-5">
    <div class="pais-header mb-4">
      <h3 class="text-white">
        <span class="pais-flag">游뻟릖</span>
        Colombia
      </h3>
      <p class="text-muted">Bolsa de Valores de Colombia (BVC)</p>
    </div>
    <div class="row">
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let accion of accionesColombia">
        <div class="card h-100 shadow-sm text-white accion-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <h5 class="card-title mb-1">{{ accion.simbolo }}</h5>
                <small class="text-muted">{{ accion.nombre }}</small>
              </div>
              <span class="badge bg-primary">Colombia</span>
            </div>

            <div class="precio-info mb-3">
              <h4 class="text-primary mb-1" *ngIf="tieneDatosPrecio(accion)">{{ formatearPrecio(accion) }}</h4>
              <h4 class="text-muted mb-1" *ngIf="!tieneDatosPrecio(accion)">N/A</h4>
              <small [ngClass]="getVariacionClass(getVariacionPorcentual(accion))">
                <i *ngIf="tieneDatosPrecio(accion)" [class]="getVariacionPorcentual(accion) >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                {{ formatearVariacionPorcentual(accion) }}
              </small>
            </div>

            <!-- Gr치fico compacto -->
            <div class="chart-container-small mb-3" *ngIf="deberaMostrarGrafico(accion.simbolo)">
              <iframe
                [src]="getChartUrl(accion.simbolo)"
                width="100%"
                height="150"
                frameborder="0"
                allowtransparency="true"
                scrolling="no"
                style="border: none;">
              </iframe>
            </div>

            <!-- Placeholder compacto -->
            <div *ngIf="!deberaMostrarGrafico(accion.simbolo)" class="chart-placeholder-small mb-3">
              <i class="bi bi-graph-up text-primary" style="font-size: 2rem;"></i>
              <p class="text-muted small mb-0">{{ accion.simbolo }}</p>
              <small class="text-muted" style="font-size: 0.7rem;">Gr치fico no disponible</small>
            </div>

            <button class="btn btn-outline-success w-100" (click)="abrirModalCompra(accion.simbolo)">
              <i class="bi bi-cart-plus me-2"></i>Comprar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 游쀯릖 ECUADOR -->
  <div *ngIf="!loading && accionesEcuador.length > 0" class="mb-5">
    <div class="pais-header mb-4">
      <h3 class="text-white">
        <span class="pais-flag">游쀯릖</span>
        Ecuador
      </h3>
      <p class="text-muted">Bolsa de Valores de Quito y Guayaquil</p>
    </div>
    <div class="row">
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let accion of accionesEcuador">
        <div class="card h-100 shadow-sm text-white accion-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <h5 class="card-title mb-1">{{ accion.simbolo }}</h5>
                <small class="text-muted">{{ accion.nombre }}</small>
              </div>
              <span class="badge bg-info">Ecuador</span>
            </div>

            <div class="precio-info mb-3">
              <h4 class="text-primary mb-1" *ngIf="tieneDatosPrecio(accion)">{{ formatearPrecio(accion) }}</h4>
              <h4 class="text-muted mb-1" *ngIf="!tieneDatosPrecio(accion)">N/A</h4>
              <small [ngClass]="getVariacionClass(getVariacionPorcentual(accion))">
                <i *ngIf="tieneDatosPrecio(accion)" [class]="getVariacionPorcentual(accion) >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                {{ formatearVariacionPorcentual(accion) }}
              </small>
            </div>

            <!-- Gr치fico compacto para acciones con s칤mbolo NYSE -->
            <div class="chart-container-small mb-3" *ngIf="deberaMostrarGrafico(accion.simbolo)">
              <iframe
                [src]="getChartUrl(accion.simbolo)"
                width="100%"
                height="150"
                frameborder="0"
                allowtransparency="true"
                scrolling="no"
                style="border: none;">
              </iframe>
            </div>

            <!-- Placeholder compacto -->
            <div *ngIf="!deberaMostrarGrafico(accion.simbolo)" class="chart-placeholder-small mb-3">
              <i class="bi bi-graph-up text-primary" style="font-size: 2rem;"></i>
              <p class="text-muted small mb-0">{{ accion.simbolo }}</p>
              <small class="text-muted" style="font-size: 0.7rem;">Gr치fico no disponible</small>
            </div>

            <button class="btn btn-outline-success w-100" (click)="abrirModalCompra(accion.simbolo)">
              <i class="bi bi-cart-plus me-2"></i>Comprar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 游왫릖 PER칔 -->
  <div *ngIf="!loading && accionesPeru.length > 0" class="mb-5">
    <div class="pais-header mb-4">
      <h3 class="text-white">
        <span class="pais-flag">游왫릖</span>
        Per칰
      </h3>
      <p class="text-muted">Bolsa de Valores de Lima (BVL)</p>
    </div>
    <div class="row">
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let accion of accionesPeru">
        <div class="card h-100 shadow-sm text-white accion-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <h5 class="card-title mb-1">{{ accion.simbolo }}</h5>
                <small class="text-muted">{{ accion.nombre }}</small>
              </div>
              <span class="badge bg-danger">Per칰</span>
            </div>

            <div class="precio-info mb-3">
              <h4 class="text-primary mb-1" *ngIf="tieneDatosPrecio(accion)">{{ formatearPrecio(accion) }}</h4>
              <h4 class="text-muted mb-1" *ngIf="!tieneDatosPrecio(accion)">N/A</h4>
              <small [ngClass]="getVariacionClass(getVariacionPorcentual(accion))">
                <i *ngIf="tieneDatosPrecio(accion)" [class]="getVariacionPorcentual(accion) >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                {{ formatearVariacionPorcentual(accion) }}
              </small>
            </div>

            <!-- Gr치fico compacto para acciones con s칤mbolo NYSE -->
            <div class="chart-container-small mb-3" *ngIf="deberaMostrarGrafico(accion.simbolo)">
              <iframe
                [src]="getChartUrl(accion.simbolo)"
                width="100%"
                height="150"
                frameborder="0"
                allowtransparency="true"
                scrolling="no"
                style="border: none;">
              </iframe>
            </div>

            <!-- Placeholder compacto -->
            <div *ngIf="!deberaMostrarGrafico(accion.simbolo)" class="chart-placeholder-small mb-3">
              <i class="bi bi-graph-up text-primary" style="font-size: 2rem;"></i>
              <p class="text-muted small mb-0">{{ accion.simbolo }}</p>
              <small class="text-muted" style="font-size: 0.7rem;">Gr치fico no disponible</small>
            </div>

            <button class="btn btn-outline-success w-100" (click)="abrirModalCompra(accion.simbolo)">
              <i class="bi bi-cart-plus me-2"></i>Comprar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 游游 VENEZUELA -->
  <div *ngIf="!loading && accionesVenezuela.length > 0" class="mb-5">
    <div class="pais-header mb-4">
      <h3 class="text-white">
        <span class="pais-flag">游游</span>
        Venezuela
      </h3>
      <p class="text-muted">Bolsa de Valores de Caracas (BVC)</p>
    </div>
    <div class="row">
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let accion of accionesVenezuela">
        <div class="card h-100 shadow-sm text-white accion-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <h5 class="card-title mb-1">{{ accion.simbolo }}</h5>
                <small class="text-muted">{{ accion.nombre }}</small>
              </div>
              <span class="badge bg-warning text-dark">Venezuela</span>
            </div>

            <div class="precio-info mb-3">
              <h4 class="text-primary mb-1" *ngIf="tieneDatosPrecio(accion)">{{ formatearPrecio(accion) }}</h4>
              <h4 class="text-muted mb-1" *ngIf="!tieneDatosPrecio(accion)">N/A</h4>
              <small [ngClass]="getVariacionClass(getVariacionPorcentual(accion))">
                <i *ngIf="tieneDatosPrecio(accion)" [class]="getVariacionPorcentual(accion) >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                {{ formatearVariacionPorcentual(accion) }}
              </small>
            </div>

            <!-- Gr치fico compacto (ninguna acci칩n venezolana tiene gr치fico) -->
            <div class="chart-container-small mb-3" *ngIf="deberaMostrarGrafico(accion.simbolo)">
              <iframe
                [src]="getChartUrl(accion.simbolo)"
                width="100%"
                height="150"
                frameborder="0"
                allowtransparency="true"
                scrolling="no"
                style="border: none;">
              </iframe>
            </div>

            <!-- Placeholder compacto -->
            <div *ngIf="!deberaMostrarGrafico(accion.simbolo)" class="chart-placeholder-small mb-3">
              <i class="bi bi-graph-up text-primary" style="font-size: 2rem;"></i>
              <p class="text-muted small mb-0">{{ accion.simbolo }}</p>
              <small class="text-muted" style="font-size: 0.7rem;">Gr치fico no disponible</small>
            </div>

            <button class="btn btn-outline-success w-100" (click)="abrirModalCompra(accion.simbolo)">
              <i class="bi bi-cart-plus me-2"></i>Comprar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay datos -->
  <div *ngIf="!loading && acciones.length === 0 && !uiMessage" class="text-center my-5">
    <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
    <p class="text-muted mt-3">No hay acciones disponibles en este momento</p>
  </div>
</div>

<!-- Modal de compra -->
<app-modal-compra
  [symbol]="symbolSeleccionado"
  (confirmar)="onConfirmarCompra($event)">
</app-modal-compra>

<!-- Modal de historial de precios -->
<app-modal-historial-precios
  [simbolo]="simboloHistorial"
  [nombreEmpresa]="nombreEmpresaHistorial">
</app-modal-historial-precios>
