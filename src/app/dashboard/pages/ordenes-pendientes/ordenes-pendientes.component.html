<div class="ordenes-pendientes-container p-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-white mb-2">
        <i class="bi bi-bell me-2"></i>
        Órdenes Pendientes
      </h2>
      <p class="text-muted">Órdenes de compra enviadas por comisionistas esperando tu aprobación</p>
    </div>
    <button class="btn btn-primary" (click)="cargarOrdenesPendientes()">
      <i class="bi bi-arrow-clockwise me-2"></i>
      Actualizar
    </button>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="Cerrar"></button>
  </div>

  <!-- Success -->
  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle-fill me-2"></i>
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Cerrar"></button>
  </div>

  <!-- Spinner -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="text-white mt-3">Cargando órdenes pendientes...</p>
  </div>

  <!-- Tarjetas de Órdenes -->
  <div *ngIf="!loading" class="row g-4">
    <div *ngIf="ordenes.length === 0" class="col-12">
      <div class="card text-center">
        <div class="card-body py-5">
          <i class="bi bi-inbox display-4 text-muted mb-3"></i>
          <p class="text-muted mb-0">No hay órdenes pendientes</p>
        </div>
      </div>
    </div>

    <div *ngFor="let orden of ordenes" class="col-md-6 col-lg-4">
      <div class="card orden-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h5 class="card-title mb-1">Orden #{{ orden.id }}</h5>
              <p class="text-muted small mb-0">Comisionista #{{ orden.idComisionista }}</p>
            </div>
            <span class="badge" [ngClass]="getEstadoBadgeClass(orden.estado)">
              {{ getEstadoTexto(orden.estado) }}
            </span>
          </div>

          <div class="orden-info mb-3">
            <div class="info-item mb-2">
              <i class="bi bi-tag me-2 text-primary"></i>
              <strong>{{ orden.simbolo }}</strong>
              <small class="text-muted d-block ms-4" *ngIf="orden.nombreEmpresa">{{ orden.nombreEmpresa }}</small>
            </div>
            <div class="info-item mb-2">
              <i class="bi bi-123 me-2 text-info"></i>
              <span>{{ orden.cantidad }} acciones</span>
            </div>
            <div class="info-item">
              <i class="bi bi-currency-dollar me-2 text-success"></i>
              <span *ngIf="orden.precioLimite">Precio límite: ${{ orden.precioLimite.toFixed(2) }}</span>
              <span *ngIf="!orden.precioLimite" class="text-muted">Sin precio límite</span>
            </div>
            <div class="info-item mt-2" *ngIf="orden.mensaje">
              <i class="bi bi-chat-left-text me-2 text-warning"></i>
              <small class="text-muted">{{ orden.mensaje }}</small>
            </div>
          </div>

          <div class="d-flex gap-2">
            <button 
              class="btn btn-outline-primary btn-sm flex-fill"
              (click)="verDetalles(orden)">
              <i class="bi bi-eye me-1"></i>
              Detalles
            </button>
            <button 
              *ngIf="puedeProcesar(orden)"
              class="btn btn-success btn-sm flex-fill"
              (click)="aceptarOrden(orden)"
              [disabled]="procesandoOrden === orden.id">
              <span *ngIf="procesandoOrden !== orden.id">
                <i class="bi bi-check-circle me-1"></i>
                Aceptar
              </span>
              <span *ngIf="procesandoOrden === orden.id">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Procesando...
              </span>
            </button>
            <button 
              *ngIf="puedeProcesar(orden)"
              class="btn btn-danger btn-sm flex-fill"
              (click)="rechazarOrden(orden)"
              [disabled]="procesandoOrden === orden.id">
              <span *ngIf="procesandoOrden !== orden.id">
                <i class="bi bi-x-circle me-1"></i>
                Rechazar
              </span>
              <span *ngIf="procesandoOrden === orden.id">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Procesando...
              </span>
            </button>
          </div>

          <small class="text-muted d-block mt-2">
            <i class="bi bi-clock me-1"></i>
            {{ formatearFecha(orden.fechaCreacion) }}
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer con contador -->
  <div *ngIf="!loading && ordenes.length > 0" class="mt-4 text-center">
    <small class="text-muted">
      Total: {{ ordenes.length }} orden(es) pendiente(s)
    </small>
  </div>

  <!-- Modal de Detalles -->
  <div *ngIf="ordenSeleccionada" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-file-text me-2"></i>
            Detalles de la Orden #{{ ordenSeleccionada.id }}
          </h5>
          <button type="button" class="btn-close" (click)="cerrarDetalles()" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">ID de Orden</label>
                <p class="info-value">{{ ordenSeleccionada.id }}</p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">Estado</label>
                <p class="info-value">
                  <span class="badge" [ngClass]="getEstadoBadgeClass(ordenSeleccionada.estado)">
                    {{ getEstadoTexto(ordenSeleccionada.estado) }}
                  </span>
                </p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">Comisionista ID</label>
                <p class="info-value">{{ ordenSeleccionada.idComisionista }}</p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">Símbolo</label>
                <p class="info-value">{{ ordenSeleccionada.simbolo }}</p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">Nombre Empresa</label>
                <p class="info-value">{{ ordenSeleccionada.nombreEmpresa || 'N/A' }}</p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">Cantidad</label>
                <p class="info-value">{{ ordenSeleccionada.cantidad }} acciones</p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">Precio Límite</label>
                <p class="info-value">
                  <span *ngIf="ordenSeleccionada.precioLimite">${{ ordenSeleccionada.precioLimite.toFixed(2) }}</span>
                  <span *ngIf="!ordenSeleccionada.precioLimite" class="text-muted">Sin límite</span>
                </p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="info-item">
                <label class="info-label">Fecha Creación</label>
                <p class="info-value">{{ formatearFecha(ordenSeleccionada.fechaCreacion) }}</p>
              </div>
            </div>
            <div class="col-12 mb-3" *ngIf="ordenSeleccionada.mensaje">
              <div class="info-item">
                <label class="info-label">Mensaje del Comisionista</label>
                <p class="info-value">{{ ordenSeleccionada.mensaje }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button 
            *ngIf="puedeProcesar(ordenSeleccionada)"
            type="button" 
            class="btn btn-success"
            (click)="aceptarOrden(ordenSeleccionada!)"
            [disabled]="procesandoOrden === ordenSeleccionada.id">
            <i class="bi bi-check-circle me-2"></i>
            Aceptar Orden
          </button>
          <button 
            *ngIf="puedeProcesar(ordenSeleccionada)"
            type="button" 
            class="btn btn-danger"
            (click)="rechazarOrden(ordenSeleccionada!)"
            [disabled]="procesandoOrden === ordenSeleccionada.id">
            <i class="bi bi-x-circle me-2"></i>
            Rechazar Orden
          </button>
          <button type="button" class="btn btn-secondary" (click)="cerrarDetalles()">
            <i class="bi bi-x-circle me-2"></i>
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

